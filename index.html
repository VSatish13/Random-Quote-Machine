<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#2196f3">
        <meta name="description" content="Read random quotes">
        <title>Random Quote Machine</title>
        <link rel="manifest" href="manifest.json">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css">
        <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/all.js" integrity="sha384-xymdQtn1n3lH2wcu0qhcdaOpQwyoarkgLVxC/wZ5q7h9gHtxICrpcaSUfygqZGOe" crossorigin="anonymous"></script>
        <style>
            #quote {
                quotes: "\f10d" "\f10e";
            }

            #quote::before {
                content: open-quote;
                font-family: "Font Awesome 5 Free";
                margin-right: 0.2em;
            }

            #quote::after {
                content: close-quote;
                font-family: "Font Awesome 5 Free";
                margin-left: 0.2em;
            }

            #author::before {
                content: "-";
                margin-right: 0.1em;
            }

            #theme {
                background-image: url('data:image/svg+xml,%3Csvg width="52" height="26" viewBox="0 0 52 26" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%239C92AC" fill-opacity="0.4"%3E%3Cpath d="M10 10c0-2.21-1.79-4-4-4-3.314 0-6-2.686-6-6h2c0 2.21 1.79 4 4 4 3.314 0 6 2.686 6 6 0 2.21 1.79 4 4 4 3.314 0 6 2.686 6 6 0 2.21 1.79 4 4 4v2c-3.314 0-6-2.686-6-6 0-2.21-1.79-4-4-4-3.314 0-6-2.686-6-6zm25.464-1.95l8.486 8.486-1.414 1.414-8.486-8.486 1.414-1.414z" /%3E%3C/g%3E%3C/g%3E%3C/svg%3E');
            }
        </style>
        <script>
            const themes = [
                // bg color, next button color, share button inverted
                ['is-primary', 'is-light', true],
                ['is-info', 'is-light', true],
                ['is-success', 'is-light', true],
                ['is-warning', 'is-dark', false],
                ['is-danger', 'is-light', true],
                ['is-light', 'is-dark', false],
                ['is-dark', 'is-light', false]
            ]

            var currentTheme = []

            function loadRandomQuote() {
                let theme = document.getElementById('theme'),
                    nextBtn = document.getElementById('next'),
                    shareBtn = document.getElementById('share')

                // show loading
                nextBtn.classList.add('is-loading')

                const xhr = new XMLHttpRequest()
                xhr.onreadystatechange = function () {
                    if (this.readyState === 4 && this.status === 200) {
                        // hide loading
                        nextBtn.classList.remove('is-loading')

                        const {
                            quote,
                            author,
                            cat: category
                        } = JSON.parse(this.responseText)
                        document.getElementById('quote').innerText = quote
                        document.getElementById('author').innerText = author

                        // remove old theme classes
                        theme.classList.remove(currentTheme[0])
                        nextBtn.classList.remove(currentTheme[1])
                        shareBtn.classList.remove('is-inverted')

                        currentTheme = themes[Math.floor(Math.random() * themes.length)]

                        // add new theme classes
                        theme.classList.add(currentTheme[0])
                        nextBtn.classList.add(currentTheme[1])
                        if (currentTheme[2]) shareBtn.classList.add('is-inverted')

                        shareBtn.setAttribute(
                            'href',
                            `https://twitter.com/intent/tweet?text=${encodeURI(
                      `"${quote}" - ${author}`
                    )}&hashtags=quotes,${category}`
                        )
                    }
                };
                xhr.open('GET', 'https://talaikis.com/api/quotes/random/', true)
                xhr.send()
            }
        </script>
    </head>
    <body onload="loadRandomQuote()">
        <section class="hero is-bold is-fullheight" id="theme">
            <div class="hero-body">
                <div class="container">
                    <h1 class="title" id="quote"></h1>
                    <h2 class="subtitle" id="author"></h2>
                    <p class="buttons is-right">
                        <a class="button is-outlined" id="next" onclick="loadRandomQuote()">
                            <span>Next</span><span class="icon"><i class="fas fa-arrow-right"></i></span>
                        </a>
                        <a class="button is-info is-outlined" id="share" target="_blank" rel="noopener">
                            <span class="icon"><i class="fab fa-twitter"></i></span><span>Share</span>
                        </a>
                    </p>
                </div>
            </div>
        </section>
    </body>
</html>
